jobs:
- deployment:
  displayName: 'Build docker image'
  environment: $(DEPLOY_ENVIRONMENT)
  strategy:
    runOnce:
      deploy:
        steps:
          - task: Docker@2
            displayName: Build and push an image to container registry
            inputs:
              command: buildAndPush
              repository: $(imageRepository)
              dockerfile: $(dockerfilePath)
              containerRegistry: $(DOCKER_REGISTRY_SERVICE_CONNECTION)
              tags: |
                $(build.buildid)
                $(tag)